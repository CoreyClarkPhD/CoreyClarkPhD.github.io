<head>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>

    <div id="myDiv">
        <!-- Plotly chart will be drawn inside this DIV -->
    </div>
    <script>
        var DataSet = {
            x: [],
            Manual: {
                upper: [],
                lower: []
            },
            Auto: {
                upper: [],
                lower: []
            },
            Mean: {
                upper: [],
                lower: []
            },
            Error: {
                Upper: {
                    auto: [],
                    manual: [],
                    percent: {
                        auto: [],
                        manual: []
                    }
                },
                Lower: {
                    auto: [],
                    manual: [],
                    percent: {
                        auto: [],
                        manual: []
                    }
                },
                Auto: {
                    upper: [],
                    lower: []
                }
            }

        };
       function makeplot() {
                Plotly.d3.csv("Image0.csv", function(data){ processData(data) } );

            };

            function processData(rows) {

                console.log(rows);

                DataSet.x = [];
                 for( var i = 0; i < rows.length; i++){
                     DataSet.x.push(Number(rows[i].Pixel));
                    //  DataSet.Manual.upper.push(-1 * Number(rows[i].UpperManual));
                    //  DataSet.Manual.lower.push(-1 * Number(rows[i].BottomManual));
                    //  DataSet.Auto.upper.push(-1 * Number(rows[i].UpperAuto));
                    //  DataSet.Auto.lower.push(-1 * Number(rows[i].BottomAuto));
                    //  DataSet.Mean.upper.push(-1 * Number(rows[i].UpperMean));
                    //  DataSet.Mean.lower.push(-1 * Number(rows[i].BottomMean));

                     DataSet.Manual.upper.push(1 * ( 496 + Number(rows[i].UpperManual)));
                     DataSet.Manual.lower.push(1 * ( 496 + Number(rows[i].BottomManual)));
                     DataSet.Auto.upper.push(1 * ( 496 + Number(rows[i].UpperAuto)));
                     DataSet.Auto.lower.push(1 * ( 496 + Number(rows[i].BottomAuto)));
                     DataSet.Mean.upper.push(1 * ( 496 + Number(rows[i].UpperMean)));
                     DataSet.Mean.lower.push(1 * ( 496 +  Number(rows[i].BottomMean)));


                    //  DataSet.Manual.upper.push(Number(rows[i].UpperManual));
                    //  DataSet.Manual.lower.push(Number(rows[i].BottomManual));
                    //  DataSet.Auto.upper.push(Number(rows[i].UpperAuto));
                    //  DataSet.Auto.lower.push(Number(rows[i].BottomAuto));
                    //  DataSet.Mean.upper.push(Number(rows[i].UpperMean));
                    //  DataSet.Mean.lower.push(Number(rows[i].BottomMean));


                     DataSet.Error.Upper.auto.push(Number(rows[i].ErrorUpperAuto));
                     DataSet.Error.Upper.manual.push(Number(rows[i].ErrorUpperManual));
                     DataSet.Error.Lower.auto.push(Number(rows[i].ErrorBottomAuto));
                     DataSet.Error.Lower.manual.push(Number(rows[i].ErrorBottomManual));
                     DataSet.Error.Upper.percent.auto.push(Number(rows[i].PercentErrorUpperAuto));
                     DataSet.Error.Upper.percent.manual.push(Number(rows[i].PercentErrorUpperManual));
                     DataSet.Error.Lower.percent.auto.push(Number(rows[i].PercentErrorBottomAuto));
                     DataSet.Error.Lower.percent.manual.push(Number(rows[i].PercentErrorBottomManual));

                     DataSet.Error.Auto.upper.push(DataSet.Auto.upper[i] - DataSet.Manual.upper[i]);
                     DataSet.Error.Auto.lower.push(DataSet.Auto.lower[i] - DataSet.Manual.lower[i])

                 }
                // var x = [], y = [], standard_deviation = [];

                // for (var i=0; i<rows.length; i++) {
                //     row = rows[i];
                //     x.push( row['AAPL_x'] );
                //     y.push( row['AAPL_y'] );
                // }

                makePlotly( DataSet.x, DataSet.Manual.lower, DataSet.Mean.lower, DataSet.Error.Lower.manual);
            }

            function makePlotly( x, y, standard_deviation ){
                var plotDiv = document.getElementById("plot");
                var traces = [{
                            x: DataSet.x,
                            y: DataSet.Manual.upper,
                            fill: 'none',
                            type: 'scatter',
                            mode: 'lines',
                            name: 'Manual Upper',
                            opacity: 0.5
                        },
                        {
                            x: DataSet.x,
                            y: DataSet.Mean.upper,
                            fill: 'tonexty',
                            type: 'scatter',
                            mode: 'lines',
                            name: 'Mean Upper',
                            opacity: 0.5
                        }
                    ];

                // var traces = [{
                //         x: DataSet.x,
                //         y: DataSet.Manual.lower,
                //         type: 'scattergl',
                //         mode: 'lines',
                //         name: 'Manual Lower',
                //         opacity: 0.5
                //     },
                //     {
                //         x: DataSet.x,
                //         y: DataSet.Mean.lower,
                //         fill: 'tonexty',
                //         type: 'scattergl',
                //         mode: 'lines',
                //         name: 'Mean Lower',
                //         opacity: 0.5
                //     }
                // ];

                var traces = [
                    {
                        x: DataSet.x,
                        y: DataSet.Manual.upper,
                        type: 'scatter',
                        mode: 'lines',
                        name: 'Manual Upper',
                        opacity: 0.5
                    },
                    {
                        x: DataSet.x,
                        y: DataSet.Mean.upper,
                        fill: 'tonexty',
                        type: 'scatter',
                        mode: 'lines',
                        name: 'Mean Upper',
                        opacity: 0.5
                    },
                    {
                        x: DataSet.x,
                        y: DataSet.Manual.lower,
                        type: 'scatter',
                        mode: 'lines',
                        name: 'Manual Lower',
                        opacity: 0.5
                    },
                    {
                        x: DataSet.x,
                        y: DataSet.Mean.lower,
                        fill: 'tonexty',
                        type: 'scatter',
                        mode: 'lines',
                        name: 'Mean Lower',
                        opacity: 0.5
                    },
                    {
                        x: DataSet.x,
                        y: DataSet.Error.Lower.manual,
                        fill: 'none',
                        type: 'bar',
                        // mode: 'lines',
                        name: 'Error Lower',
                        opacity: 0.5,
                        yaxis: 'y2'
                    },
                    {
                        x: DataSet.x,
                        y: DataSet.Error.Upper.manual,
                        fill: 'none',
                        type: 'bar',
                        // mode: 'lines',
                        name: 'Error Upper',
                        opacity: 0.5,
                        yaxis: 'y2'
                    },
                    {
                        x: DataSet.x,
                        y: DataSet.Error.Auto.lower,
                        fill: 'none',
                        type: 'bar',
                        // mode: 'lines',
                        name: 'Error Lower Auto v Man',
                        opacity: 0.5,
                        yaxis: 'y2'
                    },

                ];

                // {"x":0,"y":0.5,"layer":"below","sizex":1,"sizey":1,"height":1,"width":1,"opacity":0.25,"source": image6,"xanchor":"left","xref":"paper","yanchor":"middle","yref":"y0.5"}],"margin":{"r":50,"t":100,"b":50,"l":50},"title":"Analysis Image 6\nTotal Tests: 17\tUnique Testers: 17","width":768,"xaxis":{"autotick":true,"ticks":"","gridcolor":"rgba(102, 102, 102, 0.4)","gridwidth":1,"linecolor":"#000","range":[0,768]},"yaxis":{"autotick":true,"scaleanchor":"x","ticks":"","gridcolor":"rgba(102, 102, 102, 0.4)","gridwidth":1,"linecolor":"#000","zeroline":false,"range":[-496,0]}
                
                var layout = {
                    title: "Initial Manual vs Mean, with Error",
                    width: 1024,
                    height: 768,
                    // images:[{x:0,
                    //             y:0.5,
                    //             layer:"below",
                    //             sizex:1,
                    //             sizey:1,
                    //             height:1,
                    //             width:1,
                    //             opacity:0.25,
                    //             source:image6,
                    //             xanchor: "left",
                    //             xref: "paper",
                    //             yanchor: "middle",
                    //             yref: "y0.5"}],
                    xaxis: {
                        range: [200,501]
                    },
                    yaxis: {
                        range: [0,500]
                    },
                    yaxis2: {
                        range: [-50, 50],
                        overlaying: 'y',
                        side: 'right'
                    }

                }


                Plotly.newPlot('myDiv', traces, layout);
            };

            makeplot();


    </script>
</body>